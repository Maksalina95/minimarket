<h2 class="page-title" id="productListTitle">Товары</h2>
<div id="productList" class="product-list"></div>

<script src="scripts/config.js"></script>
<script>
  document.querySelector('.page-title')?.classList.add('fade-in');

  (async () => {
    const container = document.getElementById("productList");
    const titleEl = document.getElementById("productListTitle");

    const urlParams = new URLSearchParams(window.location.search);
    const category = urlParams.get("category");
    const subcategory = urlParams.get("subcategory");

    if (!category || !subcategory) {
      container.innerHTML = `<p style="color:red;">Категория или подкатегория не указана.</p>`;
      return;
    }

    titleEl.textContent = `${subcategory} (${category})`;

    try {
      const res = await fetch(`${baseUrl}/Лист1`);
      const data = await res.json();

      const filtered = data.filter(item =>
        item.категория?.trim() === category &&
        item.подкатегория?.trim() === subcategory
      );

      if (filtered.length === 0) {
        container.innerHTML = `<p style="color:#E0218A; font-weight: bold;">Товары не найдены.</p>`;
        return;
      }

      filtered.forEach(item => {
        const card = document.createElement("div");
        card.className = "product-card";

        const imageHtml = item.фото
          ? `<img src="${item.фото}" alt="${item.название || 'Товар'}" />`
          : "";

        card.innerHTML = `
          ${imageHtml}
          <h3>${item.название || "Без названия"}</h3>
          <p><strong>${item.цена ? item.цена + " ₽" : "Цена не указана"}</strong></p>
          ${item.описание ? `<p>${item.описание}</p>` : ""}
        `;

        container.appendChild(card);
      });

    } catch (err) {
      container.innerHTML = `<p style="color:red;">Ошибка загрузки товаров.</p>`;
      console.error(err);
    }
  })();
</script>
