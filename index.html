<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–ú–∞–∫—Å–ú–∞—Ä–∫–µ—Ç</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="manifest" href="manifest.json" />
  <link rel="icon" href="icons/icon-192.png" type="image/png" />
  <link
    href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&family=Lobster&display=swap"
    rel="stylesheet"
  />
</head>
<body>
  <header>
    <h1 class="logo">–ú–∞–∫—Å–ú–∞—Ä–∫–µ—Ç</h1>
    <button id="installApp" class="install-button" style="display:none;">üì≤ –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</button>
  </header>

  <div class="search-bar">
    <form class="search-form" onsubmit="return false;">
      <input type="text" id="searchInput" placeholder="–ù–∞–π—Ç–∏ –Ω–∞ –ú–∞–∫—Å–ú–∞—Ä–∫–µ—Ç" />
      <span id="clearSearch">‚úï</span>
      <button type="submit" id="applySearchBtn">–ü–æ–∏—Å–∫</button>
    </form>
  </div>

  <section class="slider">
    <div class="slide active">üå∏ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –ú–∞–≥–∞–∑–∏–Ω –ú–∞–∫—Å–∞–ª–∏–Ω—ã!</div>
    <div class="slide">üì¢ –ó–¥–µ—Å—å –º–æ–≥–ª–∞ –±—ã –±—ã—Ç—å –≤–∞—à–∞ –†–ï–ö–õ–ê–ú–ê</div>
  </section>

  <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è —Ö–ª–µ–±–Ω—ã–µ –∫—Ä–æ—à–∫–∏ -->
  <nav id="breadcrumbs" aria-label="–•–ª–µ–±–Ω—ã–µ –∫—Ä–æ—à–∫–∏" style="display:none;"></nav>

  <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
  <main id="mainContent">
    <h2>–ù–æ–≤–∏–Ω–∫–∏</h2>
    <ul id="suggestions"></ul>
    <div id="categoryList"></div>
    <div id="subcategoryList"></div>
    <div id="subsubcategoryList"></div>
    <div id="productList" class="product-list"></div>
  </main>

  <div class="bottom-icons" role="navigation" aria-label="–û—Å–Ω–æ–≤–Ω–æ–µ –º–µ–Ω—é">
    <button data-title="–ì–ª–∞–≤–Ω–∞—è" data-url="home.html" aria-label="–ì–ª–∞–≤–Ω–∞—è">üè†<span class="tooltip">–ì–ª–∞–≤–Ω–∞—è</span></button>
    <button data-title="–ö–∞—Ç–∞–ª–æ–≥" id="catalogBtn" aria-label="–ö–∞—Ç–∞–ª–æ–≥">üõí<span class="tooltip">–ö–∞—Ç–∞–ª–æ–≥</span></button>
    <button data-title="–ö–æ–Ω—Ç–∞–∫—Ç—ã" data-url="contacts.html" aria-label="–ö–æ–Ω—Ç–∞–∫—Ç—ã">üìû<span class="tooltip">–ö–æ–Ω—Ç–∞–∫—Ç—ã</span></button>
    <button data-title="–î–æ—Å—Ç–∞–≤–∫–∞" data-url="delivery.html" aria-label="–î–æ—Å—Ç–∞–≤–∫–∞">üöñ<span class="tooltip">–î–æ—Å—Ç–∞–≤–∫–∞</span></button>
    <button data-title="–ò–∑–±—Ä–∞–Ω–Ω–æ–µ" data-url="favorites.html" aria-label="–ò–∑–±—Ä–∞–Ω–Ω–æ–µ">‚ù§Ô∏è<span class="tooltip">–ò–∑–±—Ä–∞–Ω–Ω–æ–µ</span></button>
    <button data-title="–ê–¥—Ä–µ—Å" data-url="adress.html" aria-label="–ê–¥—Ä–µ—Å">üìç<span class="tooltip">–ê–¥—Ä–µ—Å</span></button>
    <button data-title="–£—Å–ª–æ–≤–∏—è" data-url="rules.html" aria-label="–£—Å–ª–æ–≤–∏—è">üìù<span class="tooltip">–£—Å–ª–æ–≤–∏—è</span></button>
    <button data-title="–û—Ç–∑—ã–≤—ã" data-url="reviews.html" aria-label="–û—Ç–∑—ã–≤—ã">üèÜ<span class="tooltip">–û—Ç–∑—ã–≤—ã</span></button>
    <button onclick="location.reload()" aria-label="–û–±–Ω–æ–≤–∏—Ç—å">üîÑ<span class="tooltip">–û–±–Ω–æ–≤–∏—Ç—å</span></button>
  </div>

  <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º —Ç–≤–æ–∏ —Å–∫—Ä–∏–ø—Ç—ã –∫–æ–Ω—Ñ–∏–≥ –∏ –∫–∞—Ç–∞–ª–æ–≥ -->
  <script src="—Å–∫—Ä–∏–ø—Ç—ã/–∫–æ–Ω—Ñ–∏–≥.js"></script>
  <script src="—Å–∫—Ä–∏–ø—Ç—ã/–∫–∞—Ç–∞–ª–æ–≥.js"></script>

  <script>
    // –ù–∞–≤–∏–≥–∞—Ü–∏—è –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–∞–ª–æ–≥–æ–º
    const breadcrumbs = document.getElementById('breadcrumbs');
    const categoryList = document.getElementById('categoryList');
    const subcategoryList = document.getElementById('subcategoryList');
    const subsubcategoryList = document.getElementById('subsubcategoryList');
    const productList = document.getElementById('productList');

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    loadCatalogData().then(() => {
      showCategories();
      showBreadcrumbs([]);
      showAllCatalogBlocks(false);
    });

    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–ª–∏ –ø—Ä—è—á–µ–º –±–ª–æ–∫–∏ –∫–∞—Ç–∞–ª–æ–≥–∞
    function showAllCatalogBlocks(show) {
      categoryList.style.display = show ? 'block' : 'none';
      subcategoryList.style.display = show ? 'block' : 'none';
      subsubcategoryList.style.display = show ? 'block' : 'none';
      productList.style.display = show ? 'block' : 'none';
    }

    // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Ö–ª–µ–±–Ω—ã–µ –∫—Ä–æ—à–∫–∏
    function showBreadcrumbs(path) {
      if (!path.length) {
        breadcrumbs.style.display = 'none';
        return;
      }
      breadcrumbs.style.display = 'block';
      breadcrumbs.innerHTML = '';
      path.forEach((item, i) => {
        if (i < path.length - 1) {
          const a = document.createElement('a');
          a.textContent = item.name;
          a.href = '#';
          a.onclick = (e) => {
            e.preventDefault();
            navigateTo(i);
          };
          breadcrumbs.appendChild(a);
          const sep = document.createElement('span');
          sep.textContent = '‚Ä∫';
          breadcrumbs.appendChild(sep);
        } else {
          const span = document.createElement('span');
          span.textContent = item.name;
          breadcrumbs.appendChild(span);
        }
      });
    }

    // –•—Ä–∞–Ω–µ–Ω–∏–µ –ø—É—Ç–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
    let currentPath = [];

    // –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ —É—Ä–æ–≤–Ω—é
    function navigateTo(level) {
      currentPath = currentPath.slice(0, level + 1);
      updateCatalogByPath();
    }

    // –û–±–Ω–æ–≤–ª—è–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç –≤ –∫–∞—Ç–∞–ª–æ–≥–µ –ø–æ –ø—É—Ç–∏ currentPath
    function updateCatalogByPath() {
      if (currentPath.length === 0) {
        showCategories();
      } else if (currentPath.length === 1) {
        showSubcategories(currentPath[0].name);
      } else if (currentPath.length === 2) {
        showSubsubcategories(currentPath[0].name, currentPath[1].name);
      } else if (currentPath.length === 3) {
        showProducts(currentPath[0].name, currentPath[1].name, currentPath[2].name);
      }
      showBreadcrumbs(currentPath);
      showAllCatalogBlocks(true);
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–ª–∏–∫–æ–≤ –∏–∑ —Ç–≤–æ–∏—Ö —Ñ—É–Ω–∫—Ü–∏–π –∫–∞—Ç–∞–ª–æ–≥–∞
    function showCategories() {
      const categories = [...new Set(allData.map(p => p.–∫–∞—Ç–µ–≥–æ—Ä–∏—è).filter(Boolean))];
      categoryList.innerHTML = categories.map(cat =>
        `<button class="catalog-button" onclick="onCategoryClick('${cat}')">${cat}</button>`
      ).join('');
      subcategoryList.innerHTML = '';
      subsubcategoryList.innerHTML = '';
      productList.innerHTML = '';
      showAllCatalogBlocks(true);
      currentPath = [];
      showBreadcrumbs(currentPath);
    }

    function onCategoryClick(cat) {
      currentPath = [{name: cat}];
      updateCatalogByPath();
    }

    function showSubcategories(category) {
      const subcategories = [...new Set(allData
        .filter(p => p.–∫–∞—Ç–µ–≥–æ—Ä–∏—è === category)
        .map(p => p.–ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è)
        .filter(Boolean)
      )];
      subcategoryList.innerHTML = subcategories.map(sub =>
        `<button class="catalog-button" onclick="onSubcategoryClick('${category}', '${sub}')">${sub}</button>`
      ).join('');
      subsubcategoryList.innerHTML = '';
      productList.innerHTML = '';
    }

    function onSubcategoryClick(category, subcat) {
      currentPath = [{name: category}, {name: subcat}];
      updateCatalogByPath();
    }

    function showSubsubcategories(category, subcategory) {
      const subsubcategories = [...new Set(allData
        .filter(p => p.–∫–∞—Ç–µ–≥–æ—Ä–∏—è === category && p.–ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è === subcategory)
        .map(p => p.–ø–æ–¥–ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è)
        .filter(Boolean)
      )];
      if (subsubcategories.length) {
        subsubcategoryList.innerHTML = subsubcategories.map(sub =>
          `<button class="catalog-button" onclick="onSubsubcategoryClick('${category}', '${subcategory}', '${sub}')">${sub}</button>`
        ).join('');
        productList.innerHTML = '';
      } else {
        // –ï—Å–ª–∏ –ø–æ–¥–ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–π –Ω–µ—Ç, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–≤–∞—Ä—ã —Å—Ä–∞–∑—É
        subsubcategoryList.innerHTML = '';
        showProducts(category, subcategory, null);
      }
    }

    function onSubsubcategoryClick(category, subcat, subsubcat) {
      currentPath = [{name: category}, {name: subcat}, {name: subsubcat}];
      updateCatalogByPath();
    }

    function showProducts(category, subcategory, subsubcategory) {
      const products = allData.filter(p =>
        p.–∫–∞—Ç–µ–≥–æ—Ä–∏—è === category &&
        p.–ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è === subcategory &&
        (subsubcategory ? p.–ø–æ–¥–ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è === subsubcategory : true)
      );
      renderProductList(products, productList);
    }

    function renderProductList(products, container) {
      if (!container) return;

      if (products.length === 0) {
        container.innerHTML = '<p>–¢–æ–≤–∞—Ä–æ–≤ –Ω–µ—Ç</p>';
        return;
      }

      container.innerHTML = products.map(p => `
        <div class="product-card">
          ${p.—Ñ–æ—Ç–æ ? `<img src="${p.—Ñ–æ—Ç–æ}" alt="${p.–Ω–∞–∑–≤–∞–Ω–∏–µ}" loading="lazy" />` : ''}
          <h3>${p.–Ω–∞–∑–≤–∞–Ω–∏–µ || ''}</h3>
          <p>${p.–æ–ø–∏—Å–∞–Ω–∏–µ || ''}</p>
          <p><strong>${p.—Ü–µ–Ω–∞ || ''}</strong></p>
          <div class="buttons">
            ${p.whatsapp1 ? `<a href="https://wa.me/${p.whatsapp1}" target="_blank" rel="noopener noreferrer">WhatsApp 1</a>` : ''}
            ${p.whatsapp2 ? `<a href="https://wa.me/${p.whatsapp2}" target="_blank" rel="noopener noreferrer">WhatsApp 2</a>` : ''}
            ${p.telegram ? `<a href="${p.telegram}" target="_blank" rel="noopener noreferrer">Telegram</a>` : ''}
            ${p.instagram ? `<a href="${p.instagram}" target="_blank" rel="noopener noreferrer">Instagram</a>` : ''}
          </div>
        </div>
      `).join('');
    }

    // –ö–Ω–æ–ø–∫–∞ –∫–∞—Ç–∞–ª–æ–≥–∞ –≤–Ω–∏–∑—É –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –∫–∞—Ç–∞–ª–æ–≥
    document.getElementById('catalogBtn').addEventListener('click', () => {
      showCategories();
      showAllCatalogBlocks(true);
      breadcrumbs.style.display = 'block';
      currentPath = [];
      showBreadcrumbs(currentPath);
      // –°–∫—Ä—ã–≤–∞–µ–º —Å–ª–∞–π–¥–µ—Ä –∏ –¥—Ä—É–≥–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
      document.querySelector('.slider').style.display = 'none';
    });

  </script>
</body>
</html>
