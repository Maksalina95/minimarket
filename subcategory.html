<h2 class="page-title" id="subcategoryTitle">Подкатегории</h2>
<div id="subcategoryList" class="product-list"></div>

<script src="scripts/config.js"></script>
<script>
  document.querySelector('.page-title')?.classList.add('fade-in');

  (async () => {
    const container = document.getElementById("subcategoryList");
    const titleEl = document.getElementById("subcategoryTitle");

    const urlParams = new URLSearchParams(window.location.search);
    const category = urlParams.get("category");

    if (!category) {
      container.innerHTML = `<p style="color:red;">Категория не указана.</p>`;
      return;
    }

    try {
      const res = await fetch(`${baseUrl}/Лист1`);
      const data = await res.json();

      // Фильтруем по категории и собираем уникальные подкатегории
      const subcategories = [...new Set(
        data
          .filter(item => item.категория?.trim() === category && item.подкатегория?.trim())
          .map(item => item.подкатегория.trim())
      )];

      if (subcategories.length === 0) {
        container.innerHTML = `<p style="color:#E0218A; font-weight: bold;">Подкатегории не найдены.</p>`;
        return;
      }

      titleEl.textContent = category;

      // Создаём карточки подкатегорий — кликабельные для перехода
      subcategories.forEach(subcat => {
        const card = document.createElement("div");
        card.className = "product-card";
        card.style.cursor = "pointer";
        card.innerHTML = `<h3>${subcat}</h3>`;
        card.addEventListener("click", () => {
          window.location.href = `product-list.html?category=${encodeURIComponent(category)}&subcategory=${encodeURIComponent(subcat)}`;
        });
        container.appendChild(card);
      });

    } catch (err) {
      container.innerHTML = `<p style="color:red;">Ошибка загрузки подкатегорий.</p>`;
      console.error(err);
    }
  })();
</script>
